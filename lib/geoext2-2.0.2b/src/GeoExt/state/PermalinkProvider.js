Ext.define("GeoExt.state.PermalinkProvider",{extend:"Ext.state.Provider",requires:["GeoExt.Version"],alias:"widget.gx_permalinkprovider",constructor:function(n){this.callParent(arguments);n=n||{};var t=n.url;delete n.url;Ext.apply(this,n);this.state=this.readURL(t)},encodeType:!0,readURL:function(n){var i={},r=OpenLayers.Util.getParameters(n),t,u,f;for(t in r)r.hasOwnProperty(t)&&(u=t.split("_"),u.length>1&&(f=u[0],i[f]=i[f]||{},i[f][u.slice(1).join("_")]=this.encodeType?this.decodeValue(r[t]):r[t]));return i},getLink:function(n){var r,t,u,i,e,f;n=n||document.location.href;r={};i=this.state;for(t in i)if(i.hasOwnProperty(t))for(u in i[t])r[t+"_"+u]=this.encodeType?unescape(this.encodeValue(i[t][u])):i[t][u];return OpenLayers.Util.applyDefaults(r,OpenLayers.Util.getParameters(n)),e=OpenLayers.Util.getParameterString(r),f=n.indexOf("?"),f>0&&(n=n.substring(0,f)),Ext.urlAppend(n,e)}})