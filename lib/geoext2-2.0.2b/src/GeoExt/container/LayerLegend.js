Ext.define("GeoExt.container.LayerLegend",{extend:"Ext.container.Container",requires:["GeoExt.Version","Ext.form.Label"],alias:"widget.gx_layerlegend",alternateClassName:"GeoExt.LayerLegend",statics:{getTypes:function(n,t){var f=(t||[]).concat(),u=[],e,i,o,s,r;for(i in this.types)e=this.types[i].supports(n),e>0?Ext.Array.indexOf(f,i)==-1&&u.push({type:i,score:e}):Ext.Array.remove(f,i);for(u.sort(function(n,t){return n.score<t.score?1:n.score==t.score?0:-1}),o=u.length,s=new Array(o),r=0;r<o;++r)s[r]=u[r].type;return f.concat(s)},supports:function(){},types:{}},layerRecord:null,showTitle:!0,legendTitle:null,labelCls:null,layerStore:null,initComponent:function(){var n=this;if(n.callParent(arguments),n.autoEl={},n.add({xtype:"label",html:this.getLayerTitle(this.layerRecord),cls:"x-form-item x-form-item-label"+(this.labelCls?" "+this.labelCls:"")}),n.layerRecord&&n.layerRecord.store){n.layerStore=n.layerRecord.store;n.layerStore.on("update",n.onStoreUpdate,n);n.layerStore.on("add",n.onStoreAdd,n);n.layerStore.on("remove",n.onStoreRemove,n)}},getLabel:function(){var n=this.items.get(0);return n.rendered?n.el.dom.innerHTML:n.html},onStoreRemove:function(){},onStoreAdd:function(){},onStoreUpdate:function(n,t){if(t===this.layerRecord&&this.items.getCount()>0){var i=t.getLayer();this.setVisible(i.getVisibility()&&i.calculateInRange()&&i.displayInLayerSwitcher&&!t.get("hideInLegend"));this.update()}},update:function(){var n=this.getLayerTitle(this.layerRecord),t=this.items.get(0);t instanceof Ext.form.Label&&this.getLabel()!==n&&t.setText(n,!1)},getLayerTitle:function(n){var t=this.legendTitle||"";return this.showTitle&&!t&&n&&!n.get("hideTitle")&&(t=n.get("title")||n.get("name")||n.getLayer().name||""),t},beforeDestroy:function(){this.layerStore&&(this.layerStore.un("update",this.onStoreUpdate,this),this.layerStore.un("remove",this.onStoreRemove,this),this.layerStore.un("add",this.onStoreAdd,this));this.callParent()},onDestroy:function(){this.layerRecord=null;this.layerStore=null;this.callParent(arguments)}})