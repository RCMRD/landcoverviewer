Ext.define("GeoExt.FeatureRenderer",{extend:"Ext.Component",alias:"widget.gx_renderer",requires:["GeoExt.Version"],feature:undefined,symbolizers:[OpenLayers.Feature.Vector.style["default"]],symbolType:"Polygon",resolution:1,minWidth:20,minHeight:20,renderers:["SVG","VML","Canvas"],rendererOptions:null,pointFeature:undefined,lineFeature:undefined,polygonFeature:undefined,textFeature:undefined,renderer:null,initComponent:function(){var n=this;this.autoEl={tag:"div","class":this.imgCls?this.imgCls:"",id:this.getId()};n.callParent(arguments);Ext.applyIf(this,{pointFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(0,0)),lineFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-8,-3),new OpenLayers.Geometry.Point(-3,3),new OpenLayers.Geometry.Point(3,-3),new OpenLayers.Geometry.Point(8,3)])),polygonFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(-8,-4),new OpenLayers.Geometry.Point(-6,-6),new OpenLayers.Geometry.Point(6,-6),new OpenLayers.Geometry.Point(8,-4),new OpenLayers.Geometry.Point(8,4),new OpenLayers.Geometry.Point(6,6),new OpenLayers.Geometry.Point(-6,6),new OpenLayers.Geometry.Point(-8,4)])])),textFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(0,0))});this.feature||this.setFeature(null,{draw:!1});this.addEvents("click")},initCustomEvents:function(){this.clearCustomEvents();this.el.on("click",this.onClick,this)},clearCustomEvents:function(){this.el&&this.el.removeAllListeners&&this.el.removeAllListeners()},onClick:function(){this.fireEvent("click",this)},onRender:function(){this.el||(this.el=document.createElement("div"),this.el.id=this.getId());this.renderer&&this.renderer.supported()||this.assignRenderer();this.renderer.map={getResolution:Ext.Function.bind(function(){return this.resolution},this)};this.callParent(arguments);this.drawFeature()},afterRender:function(){this.callParent(arguments);this.initCustomEvents()},onResize:function(){this.setRendererDimensions();this.callParent(arguments)},setRendererDimensions:function(){var i=this.feature.geometry.getBounds(),r=i.getWidth(),u=i.getHeight(),n=this.initialConfig.resolution;n||(n=Math.max(r/this.width||0,u/this.height||0)||1);this.resolution=n;var f=Math.max(this.width||this.minWidth,r/n),e=Math.max(this.height||this.minHeight,u/n),t=i.getCenterPixel(),o=f*n/2,s=e*n/2,h=new OpenLayers.Bounds(t.x-o,t.y-s,t.x+o,t.y+s);this.renderer.setSize(new OpenLayers.Size(Math.round(f),Math.round(e)));this.renderer.setExtent(h,!0)},assignRenderer:function(){for(var t,n=0,i=this.renderers.length;n<i;++n)if(t=OpenLayers.Renderer[this.renderers[n]],t&&t.prototype.supported()){this.renderer=new t(this.el,this.rendererOptions);break}},setSymbolizers:function(n,t){this.symbolizers=n;(!t||t.draw)&&this.drawFeature()},setSymbolType:function(n,t){this.symbolType=n;this.setFeature(null,t)},setFeature:function(n,t){this.feature=n||this[this.symbolType.toLowerCase()+"Feature"];(!t||t.draw)&&this.drawFeature()},drawFeature:function(){var n,i,r,t,u;for(this.renderer.clear(),this.setRendererDimensions(),t=0,u=this.symbolizers.length;t<u;++t)n=this.symbolizers[t],i=this.feature,n instanceof OpenLayers.Symbolizer?(n=n.clone(),OpenLayers.Symbolizer.Text&&n instanceof OpenLayers.Symbolizer.Text&&n.graphic===!1&&(n.fill=n.stroke=!1),this.initialConfig.feature||(r=n.CLASS_NAME.split(".").pop().toLowerCase(),i=this[r+"Feature"])):n=Ext.apply({},n),this.renderer.drawFeature(i.clone(),n)},update:function(n){n=n||{};n.feature?this.setFeature(n.feature,{draw:!1}):n.symbolType&&this.setSymbolType(n.symbolType,{draw:!1});n.symbolizers&&this.setSymbolizers(n.symbolizers,{draw:!1});this.drawFeature()},beforeDestroy:function(){this.clearCustomEvents();this.renderer&&this.renderer.destroy()}})