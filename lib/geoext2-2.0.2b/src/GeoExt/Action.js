Ext.define("GeoExt.Action",{extend:"Ext.Action",alias:"widget.gx_action",requires:["GeoExt.Version"],control:null,activateOnEnable:!1,deactivateOnDisable:!1,map:null,uScope:null,uHandler:null,uToggleHandler:null,uCheckHandler:null,constructor:function(n){this.uScope=n.scope;this.uHandler=n.handler;this.uToggleHandler=n.toggleHandler;this.uCheckHandler=n.checkHandler;n.scope=this;n.handler=this.pHandler;n.toggleHandler=this.pToggleHandler;n.checkHandler=this.pCheckHandler;this.control=n.control;var t=this.control;if(delete n.control,this.activateOnEnable=!!n.activateOnEnable,delete n.activateOnEnable,this.deactivateOnDisable=!!n.deactivateOnDisable,delete n.deactivateOnDisable,t){n.map&&(n.map.addControl(t),delete n.map);(n.pressed||n.checked)&&t.map&&t.activate();t.active&&(n.pressed=!0,n.checked=!0);t.events.on({activate:this.onCtrlActivate,deactivate:this.onCtrlDeactivate,scope:this})}this.callParent(arguments)},pHandler:function(){var n=this.control;n&&n.type==OpenLayers.Control.TYPE_BUTTON&&n.trigger();this.uHandler&&this.uHandler.apply(this.uScope,arguments)},pToggleHandler:function(n,t){this.changeControlState(t);this.uToggleHandler&&this.uToggleHandler.apply(this.uScope,arguments)},pCheckHandler:function(n,t){this.changeControlState(t);this.uCheckHandler&&this.uCheckHandler.apply(this.uScope,arguments)},changeControlState:function(n){n?this._activating||(this._activating=!0,this.control.activate(),this.initialConfig.pressed=!0,this.initialConfig.checked=!0,this._activating=!1):this._deactivating||(this._deactivating=!0,this.control.deactivate(),this.initialConfig.pressed=!1,this.initialConfig.checked=!1,this._deactivating=!1)},onCtrlActivate:function(){var n=this.control;n.type==OpenLayers.Control.TYPE_BUTTON?this.enable():(this.safeCallEach("toggle",[!0]),this.safeCallEach("setChecked",[!0]))},onCtrlDeactivate:function(){var n=this.control;n.type==OpenLayers.Control.TYPE_BUTTON?this.disable():(this.safeCallEach("toggle",[!1]),this.safeCallEach("setChecked",[!1]))},safeCallEach:function(n,t){for(var r=this.items,i=0,u=r.length;i<u;i++)r[i][n]&&(r[i].rendered?r[i][n].apply(r[i],t):r[i].on({render:Ext.Function.bind(r[i][n],r[i],t),single:!0}))},setDisabled:function(n){return!n&&this.activateOnEnable&&this.control&&!this.control.active&&this.control.activate(),n&&this.deactivateOnDisable&&this.control&&this.control.active&&this.control.deactivate(),GeoExt.Action.superclass.setDisabled.apply(this,arguments)}})