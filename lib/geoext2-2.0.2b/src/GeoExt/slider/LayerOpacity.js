Ext.define("GeoExt.slider.LayerOpacity",{alternateClassName:"GeoExt.LayerOpacitySlider",extend:"GeoExt.slider.MapPanelItem",requires:"GeoExt.data.LayerModel",alias:"widget.gx_opacityslider",layer:null,complementaryLayer:null,delay:5,changeVisibilityDelay:5,aggressive:!1,changeVisibility:!1,value:null,inverse:!1,constructor:function(n){n.layer&&(this.layer=this.getLayer(n.layer),this.bind(),this.complementaryLayer=this.getLayer(n.complementaryLayer),n.inverse!==undefined&&(this.inverse=n.inverse),n.value=n.value!==undefined?n.value:this.getOpacityValue(this.layer),delete n.layer,delete n.complementaryLayer);this.callParent([n])},bind:function(){if(this.layer&&this.layer.map)this.layer.map.events.on({changelayer:this.update,scope:this})},unbind:function(){this.layer&&this.layer.map&&this.layer.map.events&&this.layer.map.events.un({changelayer:this.update,scope:this})},update:function(n){n.property!=="opacity"||n.layer!=this.layer||this._settingOpacity||this.setValue(this.getOpacityValue(this.layer))},setLayer:function(n){this.unbind();this.layer=this.getLayer(n);this.setValue(this.getOpacityValue(n));this.bind()},getOpacityValue:function(n){var t;return t=n&&n.opacity!==null?parseInt(n.opacity*(this.maxValue-this.minValue)):this.maxValue,this.inverse===!0&&(t=this.maxValue-this.minValue-t),t},getLayer:function(n){return n instanceof OpenLayers.Layer?n:n instanceof GeoExt.data.LayerModel?n.getLayer():void 0},initComponent:function(){if(this.callParent(),this.changeVisibility&&this.layer&&(this.layer.opacity==0||this.inverse===!1&&this.value==this.minValue||this.inverse===!0&&this.value==this.maxValue)&&this.layer.setVisibility(!1),this.complementaryLayer&&(this.layer&&this.layer.opacity==1||this.inverse===!1&&this.value==this.maxValue||this.inverse===!0&&this.value==this.minValue)&&this.complementaryLayer.setVisibility(!1),this.aggressive===!0)this.on("change",this.changeLayerOpacity,this,{buffer:this.delay});else this.on("changecomplete",this.changeLayerOpacity,this);if(this.changeVisibility===!0)this.on("change",this.changeLayerVisibility,this,{buffer:this.changeVisibilityDelay});if(this.complementaryLayer)this.on("change",this.changeComplementaryLayerVisibility,this,{buffer:this.changeVisibilityDelay});this.on("beforedestroy",this.unbind,this)},changeLayerOpacity:function(n,t){this.layer&&(t=t/(this.maxValue-this.minValue),this.inverse===!0&&(t=1-t),this._settingOpacity=!0,this.layer.setOpacity(t),delete this._settingOpacity)},changeLayerVisibility:function(n,t){var i=this.layer.getVisibility();this.inverse===!1&&t==this.minValue||this.inverse===!0&&t==this.maxValue&&i===!0?this.layer.setVisibility(!1):(this.inverse===!1&&t>this.minValue||this.inverse===!0&&t<this.maxValue&&i==!1)&&this.layer.setVisibility(!0)},changeComplementaryLayerVisibility:function(n,t){var i=this.complementaryLayer.getVisibility();this.inverse===!1&&t==this.maxValue||this.inverse===!0&&t==this.minValue&&i===!0?this.complementaryLayer.setVisibility(!1):(this.inverse===!1&&t<this.maxValue||this.inverse===!0&&t>this.minValue&&i==!1)&&this.complementaryLayer.setVisibility(!0)}})